<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protect the Egg</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="icon" href="../assets/images/favicoon.png" type="image/png">
    <!-- A침ade el estilo de la fuente personalizada -->
    <style>
        @font-face {
            font-family: 'ND Logos Regular';
            src: url('../assets/Fonts/ND LOGOS REGULAR.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
    </style>
</head>
<body>
    <header>
        <a href="../index.html">
            <img src="../assets/images/banner.png" alt="DraxGames Banner" style="width: auto; max-width: 80%; height: auto; max-height: 300px; margin: 0 auto;">
        </a>
    </header>

    <nav>
        <a href="../index.html" class="inicio-btn">Inicio</a>
    </nav>

    <main>
        <div class="main-container">
            <section class="game-details">
                <h1>Protect the Egg</h1>
                <p>En este juego, tu misi칩n ser치 proteger la 칰ltima esperanza de la humanidad.</p>
                <div class="game-preview">
                    <iframe id="gameFrame" src="../assets/Juegos/ProtectTheEgg/index.html" frameborder="0" allowfullscreen></iframe>
                </div>
                <div class="btn-container">
                    <button class="fullscreen-btn" onclick="toggleFullscreen()">Pantalla Completa</button>
                    <a href="https://draxgames.itch.io/protect-the-egg" target="_blank"><button>Descargar</button></a>
                    <a href="https://draxgames.itch.io/protect-the-egg" target="_blank"><button>Comprar</button></a>
                </div>
            </section>
            <aside class="sidebar">
                <h2>Otros Juegos</h2>
                <ul>
                    <li>
                        <img src="../assets/images/super mario bross.png" alt="Super Mario Bros">
                        <a href="super-mario-bros.html">Super Mario Bros</a>
                    </li>
                    <li>
                        <img src="../assets/images/callofduttyZ.png" alt="Call of Dutty Zombies">
                        <a href="callofdutty-zombies.html">Call of Dutty Zombies</a>
                    </li>
                    <li>
                        <img src="../assets/images/Pixel monsters.png" alt="Pixel Monsters">
                        <a href="pixel-monsters.html">Pixel Monsters</a>
                    </li>
                    <li>
                        <img src="../assets/images/minecraft.png" alt="Minecraft Gdevelop">
                        <a href="minecraft-gdevelop.html">Minecraft Gdevelop</a>
                    </li>
                </ul>
            </aside>
        </div>
        <div class="comments">
            <h2>Comentarios</h2>
            <div id="comments-container"></div>
        
            <div id="comentar-form" style="margin-top:20px;">
                <textarea id="comment-input" placeholder="Escribe un comentario..."></textarea>
                <button onclick="enviarComentario()">Enviar</button>
            </div>
        
            <div style="margin-top:20px;">
                <button onclick="enviarLike('like')">游녨 Me gusta (<span id="like-count">0</span>)</button>
                <button onclick="enviarLike('dislike')">游녩 No me gusta (<span id="dislike-count">0</span>)</button>
            </div>
        </div>
    </main>

    <script>
        function toggleFullscreen() {
            var iframe = document.getElementById('gameFrame');
            if (iframe.requestFullscreen) {
                iframe.requestFullscreen();
            } else if (iframe.mozRequestFullScreen) { /* Firefox */
                iframe.mozRequestFullScreen();
            } else if (iframe.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
                iframe.webkitRequestFullscreen();
            } else if (iframe.msRequestFullscreen) { /* IE/Edge */
                iframe.msRequestFullscreen();
            }
        }
    </script>
</body>
<script>
    const juegoId = 4; // Cambia este ID por el correspondiente a cada juego en la base de datos
    const user = JSON.parse(localStorage.getItem("usuario"));

    function cargarComentarios() {
        fetch('../comentarios.php', {
            method: 'POST',
            body: new URLSearchParams({
                accion: 'listar',
                juego: juegoId
            })
        })
        .then(res => res.json())
        .then(data => {
            const contenedor = document.getElementById("comments-container");
            contenedor.innerHTML = data.map(c => `
                <p><strong>${c.nombre}</strong>: ${c.comentario} <br><small>${c.fecha}</small></p>
            `).join('');
        });
    }

    function enviarComentario() {
        if (!user) return alert("Debes iniciar sesi칩n para comentar");

        const texto = document.getElementById("comment-input").value;
        if (!texto) return alert("Escribe algo");

        fetch('../comentarios.php', {
            method: 'POST',
            body: new URLSearchParams({
                accion: 'agregar',
                juego: juegoId,
                comentario: texto,
                usuario_id: user.id
            })
        })
        .then(res => res.json())
        .then(() => {
            document.getElementById("comment-input").value = "";
            cargarComentarios();
        });
    }

    function enviarLike(tipo) {
        if (!user) return alert("Debes iniciar sesi칩n para votar");

        fetch('../likes.php', {
            method: 'POST',
            body: new URLSearchParams({
                usuario_id: user.id,
                juego: juegoId,
                tipo: tipo
            })
        })
        .then(res => res.json())
        .then(() => {
            contarLikes();
            alert(`Voto "${tipo}" registrado.`);
        });
    }

    function contarLikes() {
        fetch('../likes.php', {
            method: 'POST',
            body: new URLSearchParams({
                accion: 'contar',
                juego: juegoId
            })
        })
        .then(res => res.json())
        .then(data => {
            if (data.ok) {
                document.getElementById('like-count').textContent = data.likes.like;
                document.getElementById('dislike-count').textContent = data.likes.dislike;
            }
        });
    }

    window.onload = () => {
        cargarComentarios();
        contarLikes();
    };
</script>
</html>
